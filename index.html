<div id="FX_ROOT">
  <style>
    #PLAYER_EDITOR {
      background: #1a1a1a; color: white; padding: 20px; border-radius: 15px;
      font-family: 'Segoe UI', sans-serif; display: flex; gap: 20px; max-width: 950px;
    }
    .controls { flex: 1; display: flex; flex-direction: column; gap: 10px; height: 550px; overflow-y: auto; }
    .preview-area { 
      flex: 1.2; background: rgba(255,255,255,0.05); border-radius: 15px;
      display: flex; align-items: center; justify-content: center; padding: 20px; position: relative;
    }
    label { font-size: 11px; color: #888; text-transform: uppercase; margin-top: 5px; }
    input, select, textarea { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #333; background: #222; color: white; margin-bottom: 5px; }
    .btn-get-code { 
      background: #00d9ff; color: #000; border: none; padding: 12px; 
      border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 15px; width: 100%;
    }
    #PLAYER_VIEW {
      width: 280px; border-radius: 20px; padding: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.2); transition: 0.3s;
    }
  </style>

  <div id="PLAYER_EDITOR">
    <div class="controls">
      <h3 style="margin:0; color:#00d9ff;">Ultimate Audio Editor</h3>
      <label>–¶–≤–µ—Ç –ø–ª–µ–µ—Ä–∞: <input type="color" id="p_color" value="#00d9ff"></label>
      <label>–†–∞–∑–º–µ—Ä: <input type="range" id="p_scale" min="0.5" max="1.5" step="0.1" value="1"></label>
      <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å: <input type="range" id="p_vol" min="0" max="1" step="0.1" value="0.8"></label>
      <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø–ª–µ–µ—Ä–∞: <input type="text" id="p_img" value="https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=400"></label>
      <label>–°—Å—ã–ª–∫–∏ –Ω–∞ –º—É–∑—ã–∫—É (–∫–∞–∂–¥–∞—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):</label>
      <textarea id="p_list" style="height:120px;">https://ryabchevskayav-pixel.github.io/audio/track1.mp3</textarea>
      
      <button class="btn-get-code" onclick="copyPlayerCode()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î –î–õ–Ø GENIALLY</button>
      <p style="font-size:10px; color:#aaa;">*–°–æ–≤–µ—Ç: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ .mp3</p>
    </div>

    <div class="preview-area">
      <div id="PLAYER_VIEW" style="background: rgba(0, 217, 255, 0.2); backdrop-filter: blur(10px);">
        <img id="prev_img" src="https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=400" style="width:100%; height:140px; border-radius:10px; object-fit:cover;">
        <div style="font-weight:bold; margin-top:10px;">Preview Mode</div>
        <div style="font-size:10px; opacity:0.6;">–í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –∏ –∑–≤—É–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ –≤ Genially</div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('p_color').oninput = (e) => {
        const c = e.target.value;
        document.getElementById('PLAYER_VIEW').style.background = c + '33';
        document.getElementById('PLAYER_VIEW').style.borderColor = c + '66';
    };
    document.getElementById('p_scale').oninput = (e) => {
        document.getElementById('PLAYER_VIEW').style.transform = `scale(${e.target.value})`;
    };

    function copyPlayerCode() {
      const color = document.getElementById('p_color').value;
      const img = document.getElementById('p_img').value;
      const scale = document.getElementById('p_scale').value;
      const vol = document.getElementById('p_vol').value;
      
      let rawTracks = document.getElementById('p_list').value.split('\n').map(s => s.trim()).filter(s => s.length > 5);
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ GitHub
      let tracks = rawTracks.map(s => {
          if(s.includes('github.com') && !s.includes('raw.githubusercontent')) {
              return s.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/');
          }
          return s;
      });

      const finalCode = `<div id="AUDIO_PLAYER_WIDGET" style="width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:transparent;">
  <style>
    .player-wrap {
      width: 300px; transform: scale(${scale}); background: ${color}4d; backdrop-filter: blur(20px);
      border-radius: 30px; padding: 25px; color: white; text-align: center; font-family: sans-serif;
      border: 1px solid ${color}80; box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    }
    .player-img { width: 100%; height: 160px; border-radius: 20px; object-fit: cover; margin-bottom: 15px; }
    .p-slider { width: 100%; accent-color: white; cursor: pointer; margin: 10px 0; }
    .v-bars { display: flex; justify-content: center; align-items: flex-end; gap: 4px; height: 35px; margin-bottom: 15px; }
    .v-bar { width: 6px; background: white; border-radius: 3px; height: 5px; transition: height 0.1s; }
    .p-btns { display: flex; justify-content: space-between; align-items: center; margin: 15px 0; }
    .p-btn { cursor: pointer; font-size: 26px; transition: 0.3s; opacity: 0.8; }
    .p-btn:hover { opacity: 1; transform: scale(1.1); color: ${color}; }
    .err { font-size: 10px; color: #ff6b6b; margin-top: 10px; display: none; }
  </style>

  <div class="player-wrap">
    <img src="${img}" class="player-img">
    <div id="p_name" style="font-size:14px; font-weight:bold; height:20px; overflow:hidden;">Track</div>
    
    <div class="v-bars" id="v_bars">
      <div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div><div class="v-bar"></div>
    </div>

    <input type="range" id="p_seek" class="p-slider" value="0">
    
    <div class="p-btns">
      <span class="p-btn" onclick="player.change(-1)">‚èÆ</span>
      <span class="p-btn" id="p_play" onclick="player.toggle()" style="font-size:45px">‚ñ∂</span>
      <span class="p-btn" onclick="player.change(1)">‚è≠</span>
    </div>

    <div style="display:flex; align-items:center; gap:10px; font-size:12px;">
      <span>üîà</span><input type="range" id="p_vol" class="p-slider" min="0" max="1" step="0.05" value="${vol}"><span>üîä</span>
    </div>
    <div id="p_err" class="err">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É.</div>
  </div>

  <script>
    var player = {
      list: ${JSON.stringify(tracks)},
      idx: 0, 
      audio: new Audio(),
      init: function() {
        this.audio.crossOrigin = "anonymous";
        this.audio.volume = ${vol};
        this.load();
        
        this.audio.ontimeupdate = () => {
          if(!isNaN(this.audio.duration)) {
            document.getElementById('p_seek').value = (this.audio.currentTime / this.audio.duration) * 100;
          }
          if(!this.audio.paused) this.animate();
        };

        this.audio.onerror = () => { document.getElementById('p_err').style.display = 'block'; };
        this.audio.onplay = () => { document.getElementById('p_err').style.display = 'none'; };
        this.audio.onended = () => this.change(1);

        document.getElementById('p_seek').oninput = (e) => {
          this.audio.currentTime = (e.target.value / 100) * this.audio.duration;
        };
        document.getElementById('p_vol').oninput = (e) => { this.audio.volume = e.target.value; };
      },
      load: function() {
        this.audio.src = this.list[this.idx];
        let name = this.list[this.idx].split('/').pop().split('?')[0];
        document.getElementById('p_name').innerText = decodeURI(name);
      },
      toggle: function() {
        if(this.audio.paused) {
          this.audio.play().catch(e => console.log("–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞"));
          document.getElementById('p_play').innerText = '‚è∏';
        } else {
          this.audio.pause();
          document.getElementById('p_play').innerText = '‚ñ∂';
          this.resetBars();
        }
      },
      change: function(dir) {
        this.idx = (this.idx + dir + this.list.length) % this.list.length;
        this.load();
        this.audio.play();
        document.getElementById('p_play').innerText = '‚è∏';
      },
      animate: function() {
        document.querySelectorAll('.v-bar').forEach(b => {
          b.style.height = (Math.random() * 30 + 5) + 'px';
          b.style.background = '${color}';
        });
      },
      resetBars: function() {
        document.querySelectorAll('.v-bar').forEach(b => b.style.height = '5px');
      }
    };
    player.init();
  <\/script>
</div>`;

      const el = document.createElement('textarea');
      el.value = finalCode; document.body.appendChild(el); el.select();
      document.execCommand('copy'); document.body.removeChild(el);
      alert('–ì–æ—Ç–æ–≤–æ! –ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω.');
    }
  </script>
</div>
