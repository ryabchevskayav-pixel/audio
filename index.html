<div id="FX_ROOT">
  <style>
    #PLAYER_EDITOR {
      background: #1a1a1a; color: white; padding: 20px; border-radius: 15px;
      font-family: 'Segoe UI', sans-serif; display: flex; gap: 20px; max-width: 950px;
    }
    .controls { flex: 1; display: flex; flex-direction: column; gap: 10px; height: 500px; overflow-y: auto; padding-right: 10px; }
    .preview-area { 
      flex: 1.2; background: rgba(255,255,255,0.05); border-radius: 15px;
      display: flex; align-items: center; justify-content: center; padding: 20px; overflow: hidden;
    }
    label { font-size: 11px; color: #888; text-transform: uppercase; margin-top: 5px; display: block; }
    input, select, textarea { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #333; background: #222; color: white; margin-bottom: 5px; }
    .btn-get-code { 
      background: #00d9ff; color: #000; border: none; padding: 12px; 
      border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 15px; width: 100%;
    }
    /* –°—Ç–∏–ª–∏ –ø—Ä–µ–≤—å—é */
    #PLAYER_VIEW {
      width: 280px; transition: all 0.3s ease;
      border-radius: 20px; padding: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.2);
    }
    .visualizer-mini { display: flex; justify-content: center; gap: 3px; height: 20px; margin-top: 10px; }
    .bar-mini { width: 4px; background: #00d9ff; border-radius: 2px; animation: bounce 1s infinite alternate; }
    @keyframes bounce { 10% { height: 5px; } 100% { height: 20px; } }
  </style>

  <div id="PLAYER_EDITOR">
    <div class="controls">
      <h3 style="margin:0 0 10px 0; color:#00d9ff;">Pro Music Editor</h3>
      
      <label>–Ø–∑—ã–∫: <select id="p_lang"><option value="ru">–†—É—Å—Å–∫–∏–π</option><option value="en">English</option></select></label>
      <label>–¶–≤–µ—Ç –ø–ª–µ–µ—Ä–∞: <input type="color" id="p_color" value="#00d9ff"></label>
      <label>–†–∞–∑–º–µ—Ä –ø–ª–µ–µ—Ä–∞ (–º–∞—Å—à—Ç–∞–±): <input type="range" id="p_scale" min="0.5" max="1.5" step="0.1" value="1"></label>
      <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: <input type="range" id="p_vol" min="0" max="1" step="0.1" value="0.7"></label>
      <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ (URL): <input type="text" id="p_img" value="https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=400"></label>
      <label>–°—Å—ã–ª–∫–∏ –Ω–∞ MP3 (—Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):</label>
      <textarea id="p_list" style="height:80px;">https://ryabchevskayav-pixel.github.io/audio/track1.mp3</textarea>
      
      <button class="btn-get-code" onclick="copyPlayerCode()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î –ü–õ–ï–ï–†–ê</button>
    </div>

    <div class="preview-area">
      <div id="PLAYER_VIEW" style="background: rgba(0, 217, 255, 0.2); backdrop-filter: blur(10px);">
        <img id="prev_img" src="https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=400" style="width:100%; height:140px; border-radius:10px; object-fit:cover;">
        <div style="font-weight:bold; margin-top:10px;">Song Title</div>
        
        <div class="visualizer-mini">
          <div class="bar-mini"></div><div class="bar-mini" style="animation-delay:0.2s"></div>
          <div class="bar-mini" style="animation-delay:0.4s"></div><div class="bar-mini" style="animation-delay:0.1s"></div>
        </div>

        <input type="range" style="width:100%; margin:15px 0; accent-color:#00d9ff" value="40">
        <div style="font-size:24px; display:flex; justify-content:space-around"><span>‚èÆ</span> <span>‚ñ∂</span> <span>‚è≠</span></div>
      </div>
    </div>
  </div>

  <script>
    // –ñ–∏–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é
    document.getElementById('p_color').oninput = (e) => {
        const c = e.target.value;
        document.getElementById('PLAYER_VIEW').style.background = c + '33'; // 33 - –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å HEX
        document.getElementById('PLAYER_VIEW').style.borderColor = c + '66';
        document.querySelectorAll('.bar-mini').forEach(b => b.style.background = c);
    };
    document.getElementById('p_scale').oninput = (e) => {
        document.getElementById('PLAYER_VIEW').style.transform = `scale(${e.target.value})`;
    };

    function copyPlayerCode() {
      const color = document.getElementById('p_color').value;
      const img = document.getElementById('p_img').value;
      const lang = document.getElementById('p_lang').value;
      const scale = document.getElementById('p_scale').value;
      const volume = document.getElementById('p_vol').value;
      
      let tracks = document.getElementById('p_list').value.split('\n')
        .map(s => s.trim()).filter(s => s.length > 5)
        .map(s => (s.includes('github.com') && !s.includes('raw.githubusercontent')) ? s.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/') : s);

      const finalCode = `<div id="G_PLAYER_CONTAINER" style="display:flex; justify-content:center; align-items:center; background:transparent; width:100%; height:100%; overflow:hidden;">
  <style>
    .p-card {
      width: 300px; transform: scale(${scale}); background: ${color}4d; backdrop-filter: blur(15px);
      border-radius: 25px; padding: 20px; color: white; text-align: center; font-family: sans-serif;
      border: 1px solid ${color}80; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    }
    .p-art { width: 100%; height: 150px; border-radius: 15px; object-fit: cover; margin-bottom: 10px; }
    .p-slider { width: 100%; accent-color: ${color}; cursor: pointer; margin: 10px 0; }
    .v-container { display: flex; justify-content: center; align-items: flex-end; gap: 3px; height: 30px; margin-bottom: 10px; }
    .v-bar { width: 5px; background: white; border-radius: 2px; transition: height 0.1s ease; }
    .p-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
    .p-btn { cursor: pointer; font-size: 24px; transition: 0.2s; }
    .p-btn:hover { transform: scale(1.1); color: ${color}; }
    .vol-box { display: flex; align-items: center; gap: 8px; margin-top: 15px; font-size: 12px; opacity: 0.8; }
  </style>

  <div class="p-card">
    <img src="${img}" class="p-art">
    <div id="p_title" style="font-size:14px; font-weight:bold; white-space:nowrap; overflow:hidden;">Track Name</div>
    
    <div class="v-container" id="v_box">
      <div class="v-bar" style="height:5px"></div><div class="v-bar" style="height:10px"></div>
      <div class="v-bar" style="height:7px"></div><div class="v-bar" style="height:12px"></div>
      <div class="v-bar" style="height:5px"></div>
    </div>

    <input type="range" id="p_seek" class="p-slider" value="0">
    
    <div class="p-controls">
      <span class="p-btn" onclick="ap.prev()">‚èÆ</span>
      <span class="p-btn" id="p_main" onclick="ap.toggle()" style="font-size:40px">‚ñ∂</span>
      <span class="p-btn" onclick="ap.next()">‚è≠</span>
    </div>

    <div class="vol-box">
      <span>üîà</span><input type="range" id="p_volume" class="p-slider" min="0" max="1" step="0.1" value="${volume}"><span>üîä</span>
    </div>
  </div>

  <script>
    var ap = {
      list: ${JSON.stringify(tracks)},
      idx: 0, audio: new Audio(),
      init: function() {
        this.audio.crossOrigin = "anonymous";
        this.audio.volume = ${volume};
        this.load();
        this.audio.ontimeupdate = () => { if(!isNaN(this.audio.duration)) document.getElementById('p_seek').value = (this.audio.currentTime / this.audio.duration) * 100; this.anim(); };
        document.getElementById('p_seek').oninput = (e) => { this.audio.currentTime = (e.target.value / 100) * this.audio.duration; };
        document.getElementById('p_volume').oninput = (e) => { this.audio.volume = e.target.value; };
      },
      load: function() {
        this.audio.src = this.list[this.idx];
        document.getElementById('p_title').innerText = decodeURI(this.list[this.idx].split('/').pop().replace('.mp3',''));
      },
      toggle: function() {
        if(this.audio.paused) { this.audio.play(); document.getElementById('p_main').innerText = '‚è∏'; }
        else { this.audio.pause(); document.getElementById('p_main').innerText = '‚ñ∂'; resetBars(); }
      },
      next: function() { this.idx = (this.idx + 1) % this.list.length; this.load(); this.audio.play(); },
      prev: function() { this.idx = (this.idx - 1 + this.list.length) % this.list.length; this.load(); this.audio.play(); },
      anim: function() {
        if(!this.audio.paused) {
          document.querySelectorAll('.v-bar').forEach(b => { b.style.height = Math.random() * 25 + 5 + 'px'; });
        }
      }
    };
    function resetBars() { document.querySelectorAll('.v-bar').forEach(b => b.style.height = '5px'); }
    ap.init();
  <\/script>
</div>`;

      const el = document.createElement('textarea');
      el.value = finalCode; document.body.appendChild(el); el.select();
      document.execCommand('copy'); document.body.removeChild(el);
      alert('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –í—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ Genially.');
    }
  </script>
</div>
